\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{splitV2}[2025/04/22 Improved column layouts for beamer slides]

%--------------------------------------------------------%
%       Configuration Options                             %
%--------------------------------------------------------%

% Load required packages
\RequirePackage{pgf}   % For calculations

% Define column separation
\newlength{\splitVsep}
\setlength{\splitVsep}{1em}

% Configuration command for column separation
\newcommand{\splitVSetSep}[1]{%
  \setlength{\splitVsep}{#1}%
}

%--------------------------------------------------------%
%       Core Two-Column Layout Implementation             %
%--------------------------------------------------------%

% Base macro for two-column layouts using lrbox for maximum compatibility
% Parameters:
% [1] = left column width ratio (optional, default 0.5)
% [2] = left column vertical alignment (t, c, b)
% [3] = overall column alignment (unused in minipage approach but kept for API consistency)
% [4] = left column content
% [5] = right column vertical alignment (t, c, b)
% [6] = right column content
\newcommand{\splitVBase}[6][0.5]{%
  % Create a complete box that contains both columns
  \begin{lrbox}{0}%
    \begin{minipage}{\textwidth}%
      \begin{minipage}[#2]{#1\textwidth}%
        #4%
      \end{minipage}%
      \hfill%
      \begin{minipage}[#5]{\dimexpr\textwidth-#1\textwidth-\splitVsep\relax}%
        #6%
      \end{minipage}%
    \end{minipage}%
  \end{lrbox}%
  \usebox{0}%
}

%--------------------------------------------------------%
%       Standard Two-Column Layout Commands               %
%--------------------------------------------------------%

% TT: Both columns top-aligned
\newcommand{\splitVTT}[3][0.5]{%
  \splitVBase[#1]{t}{T}{#2}{t}{#3}%
}

% CC: Both columns centered
\newcommand{\splitVCC}[3][0.5]{%
  \splitVBase[#1]{c}{c}{#2}{c}{#3}%
}

% BB: Both columns bottom-aligned
\newcommand{\splitVBB}[3][0.5]{%
  \splitVBase[#1]{b}{b}{#2}{b}{#3}%
}

% TC: Left column top-aligned, Right column centered
\newcommand{\splitVTC}[3][0.5]{%
  \splitVBase[#1]{t}{T}{#2}{c}{#3}%
}

% CT: Left column centered, Right column top-aligned
\newcommand{\splitVCT}[3][0.5]{%
  \splitVBase[#1]{c}{c}{#2}{t}{#3}%
}

% TB: Left column top-aligned, Right column bottom-aligned
\newcommand{\splitVTB}[3][0.5]{%
  \splitVBase[#1]{t}{T}{#2}{b}{#3}%
}

% BT: Left column bottom-aligned, Right column top-aligned
\newcommand{\splitVBT}[3][0.5]{%
  \splitVBase[#1]{b}{b}{#2}{t}{#3}%
}

% CB: Left column centered, Right column bottom-aligned
\newcommand{\splitVCB}[3][0.5]{%
  \splitVBase[#1]{c}{c}{#2}{b}{#3}%
}

% BC: Left column bottom-aligned, Right column centered
\newcommand{\splitVBC}[3][0.5]{%
  \splitVBase[#1]{b}{b}{#2}{c}{#3}%
}

% The original splitV command as an alias to splitVCC
\let\splitV\splitVCC

%--------------------------------------------------------%
%       Three-Column Layout Implementation                %
%--------------------------------------------------------%

% Base three-column layout (used by other three-column commands)
% Parameters:
% [1], [2], [3] = column width ratios (optional)
% [4], [5], [6] = column alignments (t, c, b)
% [7], [8], [9] = column contents
\newcommand{\splitVThreeBase}[9]{%
  % Create a complete box that contains all three columns
  \begin{lrbox}{0}%
    \begin{minipage}{\textwidth}%
      \begin{minipage}[#4]{#1\textwidth}%
        #7%
      \end{minipage}%
      \hfill%
      \begin{minipage}[#5]{#2\textwidth}%
        #8%
      \end{minipage}%
      \hfill%
      \begin{minipage}[#6]{#3\textwidth}%
        #9%
      \end{minipage}%
    \end{minipage}%
  \end{lrbox}%
  \usebox{0}%
}

% Simple three-column layout with equal width columns
\newcommand{\splitVThree}[3]{%
  \splitVThreeBase{0.31}{0.31}{0.31}{c}{c}{c}{#1}{#2}{#3}%
}

% Three-column layout with custom width columns and center alignment
\newcommand{\splitVThreeC}[6][0.31]{%
  % Calculate safe column widths
  \pgfmathsetmacro{\colonewidth}{#1}%
  \pgfmathsetmacro{\coltwowidth}{#2}%
  % If third width is auto, calculate it
  \ifdim#3pt=0pt
    \pgfmathsetmacro{\colthreewidth}{max(0.05, 0.97-\colonewidth-\coltwowidth)}%
  \else
    \pgfmathsetmacro{\colthreewidth}{#3}%
  \fi
  % Create the layout
  \splitVThreeBase{\colonewidth}{\coltwowidth}{\colthreewidth}{c}{c}{c}{#4}{#5}{#6}%
}

% Three-column layout with custom width columns and top alignment
\newcommand{\splitVThreeT}[6][0.31]{%
  % Calculate safe column widths
  \pgfmathsetmacro{\colonewidth}{#1}%
  \pgfmathsetmacro{\coltwowidth}{#2}%
  % If third width is auto, calculate it
  \ifdim#3pt=0pt
    \pgfmathsetmacro{\colthreewidth}{max(0.05, 0.97-\colonewidth-\coltwowidth)}%
  \else
    \pgfmathsetmacro{\colthreewidth}{#3}%
  \fi
  % Create the layout
  \splitVThreeBase{\colonewidth}{\coltwowidth}{\colthreewidth}{t}{t}{t}{#4}{#5}{#6}%
}

% Backward compatibility
\let\splitVThreeCustom\splitVThreeC

%--------------------------------------------------------%
%       Grid Layouts                                      %
%--------------------------------------------------------%

% Simple 2Ã—2 grid layout
\newcommand{\twobytwo}[4]{%
  % Create top row
  \begin{lrbox}{0}%
    \begin{minipage}{\textwidth}%
      % Top row
      \begin{minipage}[c]{0.48\textwidth}%
        \centering #1%
      \end{minipage}%
      \hfill%
      \begin{minipage}[c]{0.48\textwidth}%
        \centering #2%
      \end{minipage}%
      
      \vspace{1ex}% Space between rows
      
      % Bottom row
      \begin{minipage}[c]{0.48\textwidth}%
        \centering #3%
      \end{minipage}%
      \hfill%
      \begin{minipage}[c]{0.48\textwidth}%
        \centering #4%
      \end{minipage}%
    \end{minipage}%
  \end{lrbox}%
  \usebox{0}%
}

% More general grid layout with custom sizes
\newcommand{\gridLayout}[5][0.48]{%
  % #1 = column width (optional, default 0.48)
  % #2-#5 = the four contents
  % Create the entire grid
  \begin{lrbox}{0}%
    \begin{minipage}{\textwidth}%
      % Top row
      \begin{minipage}[c]{#1\textwidth}%
        \centering #2%
      \end{minipage}%
      \hfill%
      \begin{minipage}[c]{\dimexpr\textwidth-#1\textwidth-\splitVsep\relax}%
        \centering #3%
      \end{minipage}%
      
      \vspace{1ex}% Space between rows
      
      % Bottom row
      \begin{minipage}[c]{#1\textwidth}%
        \centering #4%
      \end{minipage}%
      \hfill%
      \begin{minipage}[c]{\dimexpr\textwidth-#1\textwidth-\splitVsep\relax}%
        \centering #5%
      \end{minipage}%
    \end{minipage}%
  \end{lrbox}%
  \usebox{0}%
}

%--------------------------------------------------------%
%       Special Commands for Common Cases                 %
%--------------------------------------------------------%

% Image and text side by side with the image on the right
% A common pattern in presentations
\newcommand{\splitVImage}[3][0.6]{%
  % #1 = text width ratio (optional, default 0.6)
  % #2 = text content
  % #3 = image command
  \splitVCC[#1]{#2}{#3}%
}

% Image and text side by side with the image on the left
\newcommand{\splitVImageLeft}[3][0.4]{%
  % #1 = image width ratio (optional, default 0.4)
  % #2 = image command
  % #3 = text content
  \splitVCC[#1]{#2}{#3}%
}

\endinput